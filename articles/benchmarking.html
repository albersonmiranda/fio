<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking • fio</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking">
<meta property="og:description" content="fio">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fio</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/albersonmiranda/fio" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Benchmarking</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/albersonmiranda/fio/blob/HEAD/vignettes/articles/benchmarking.Rmd" class="external-link"><code>vignettes/articles/benchmarking.Rmd</code></a></small>
      <div class="hidden name"><code>benchmarking.Rmd</code></div>

    </div>

    
    
<style>
p.caption {
  font-size: 0.6em;
  text-align: "center";
}
</style>
<div class="section level2">
<h2 id="disclaimer">DISCLAIMER<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>The present benchmark was conducted on a Samsung laptop
(550XCJ/550XCR, Intel i7, 8GB RAM) on Ubuntu 22.04.4 LTS x86_64, which
is a pretty average machine. For similar hardware (e.g., Intel i5, 16GB
RAM), the results should hold. In the other hand, for slower hardware
(e.g., budget VMs like free plan on Posit Cloud, which is single core,
1GB RAM) results may vary. For faster machines (e.g., 16-core, 64GB RAM
1, Github Codespaces), differences are only marginal. That is,
<strong>for fast enough machines, performance isn’t an issue</strong>
and even base R code should be fast enough for input-output analysis
with big matrices.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette presents a benchmarking analysis comparing the
performance of functions from the <code>fio</code> package with
equivalent base R functions. The <code>fio</code> package provides a set
of functions for input-output analysis, a method used in economics to
analyze the interdependencies between different sectors of an
economy.</p>
<p>In this document, we will focus on two key functions: the technical
coefficients matrix calculation and the Leontief inverse matrix
calculation. These functions are fundamental to input-output analysis,
and their performance can significantly impact the speed of larger
analyses.</p>
<p>Our benchmarking tests, which involve running these functions
repeatedely in simulated datasets, show that the <code>fio</code>
package functions are faster than the equivalent base R functions. This
improved performance can make a substantial difference in larger
analyses, making the <code>fio</code> package a valuable tool for
input-output analysis in R.</p>
<p>The tests were run on a simulated <span class="math inline">\(2000
\times 2000\)</span> matrix, and each test was repeated 100 times to
account for variability. Please note that the results of this
benchmarking analysis are dependent on the specific test datasets used
and the hardware on which the algorithms were run. Therefore, the
results should be interpreted in the context of these specific
conditions.</p>
</div>
<div class="section level2">
<h2 id="technical-coefficients-matrix">Technical coefficients matrix<a class="anchor" aria-label="anchor" href="#technical-coefficients-matrix"></a>
</h2>
<p>The technical coefficients matrix calculation, a key and initial step
in input-output analysis, was tested using the
<code><a href="../reference/compute_tech_coeff.html">compute_tech_coeff()</a></code> function from the <a href="https://albersonmiranda.github.io/fio/">fio</a>
package, equivalent functions from the <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a> package,
and a base R implementation. It consists on dividing each <span class="math inline">\(a_{ij}\)</span> element of intermediate
transactions matrix by the correspondent <span class="math inline">\(x_j\)</span> element of total production vector<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The
results show that both <a href="https://albersonmiranda.github.io/fio/">fio</a> and <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a>
functions execute almost instantaneously, with <a href="https://albersonmiranda.github.io/fio/">fio</a>
slightly faster (about 5 milliseconds apart). In contrast, the base R
implementation is about 150 times slower than <a href="https://albersonmiranda.github.io/fio/">fio</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># data</span></span>
<span><span class="va">matrix_dim</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span><span class="op">)</span></span>
<span><span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Base R function</span></span>
<span><span class="va">tech_coeff_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tech_coeff_matrix</span> <span class="op">&lt;-</span> <span class="va">intermediate_transactions</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">total_production</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tech_coeff_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># {fio} setup</span></span>
<span><span class="va">iom_fio</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"iom"</span>, <span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_a</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu"><a href="../reference/compute_tech_coeff.html">compute_tech_coeff</a></span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>  `Base R` <span class="op">=</span> <span class="fu">tech_coeff_r</span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>  leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/input_requirement.html" class="external-link">input_requirement</a></span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_a</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr        min         lq       mean     median         uq        max neval</span></span>
<span><span class="co">#&gt;       fio   19.79948   27.52306   32.46416   30.59574   35.91537   89.63771   100</span></span>
<span><span class="co">#&gt;    Base R 5397.60696 5871.49346 6400.70644 6236.49741 7004.75749 7892.10966   100</span></span>
<span><span class="co">#&gt;  leontief   25.69267   33.26089   40.73125   38.84038   44.42781  112.25745   100</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_a</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_a-1.png" alt="\label{fig:benchmark_a}Base R is about 100 times slower than {fio} and {leontief} functions." width="70%"><p class="caption">
Base R is about 100 times slower than {fio} and {leontief} functions.
</p>
</div>
</div>
<div class="section level2">
<h2 id="leontief-inverse-matrix">Leontief inverse matrix<a class="anchor" aria-label="anchor" href="#leontief-inverse-matrix"></a>
</h2>
<p>When we’re talking about inverting a <span class="math inline">\(2000
\times 2000\)</span> there’s a lot more work involved. Leontief matrix
(<span class="math inline">\(B\)</span>) is obtained from subtracting
the technical coefficients matrix (<span class="math inline">\(A\)</span>) from the identity matrix (<span class="math inline">\(I\)</span>), therefore it has no null rows or
columns.</p>
<p><span class="math display">\[B = I - A\]</span></p>
<p>It allows for solving the linear system through LU decomposition,
which is a more efficient method than the direct inverse matrix
calculation. <a href="https://albersonmiranda.github.io/fio/">fio</a> takes advantage of LU decomposition and
becomes incredibly faster, while <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a> is over 10
times slower, followed closed by the over 20 times slower base R
implementation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data</span></span>
<span><span class="va">iom_fio</span><span class="op">$</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">technical_coefficients_matrix</span> <span class="op">&lt;-</span> <span class="va">iom_fio</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span></span>
<span></span>
<span><span class="co"># base R function</span></span>
<span><span class="va">leontief_inverse_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span></span>
<span>  <span class="va">leontief_inverse_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dim</span><span class="op">)</span> <span class="op">-</span> <span class="va">technical_coefficients_matrix</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_b</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu"><a href="../reference/compute_leontief_inverse.html">compute_leontief_inverse</a></span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>  `Base R` <span class="op">=</span> <span class="fu">leontief_inverse_r</span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>  leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/leontief_inverse.html" class="external-link">leontief_inverse</a></span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr       min        lq      mean    median        uq      max neval</span></span>
<span><span class="co">#&gt;       fio  247.3609  285.6822  312.9184  301.5624  329.7859  543.802   100</span></span>
<span><span class="co">#&gt;    Base R 5177.8100 5531.5195 5700.7660 5596.1821 5722.3004 7489.067   100</span></span>
<span><span class="co">#&gt;  leontief 4671.1566 4970.6219 5143.4911 5065.7830 5216.6950 6979.434   100</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_b</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_b-1.png" alt="\label{fig:figs} {fio} is about 20 times faster than {leontief} and base R functions." width="70%"><p class="caption">
{fio} is about 20 times faster than {leontief} and base R functions.
</p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-of-dispersion-coefficients-of-variation">Sensitivity of dispersion coefficients of variation<a class="anchor" aria-label="anchor" href="#sensitivity-of-dispersion-coefficients-of-variation"></a>
</h2>
<p>To represent linkage-based functions performance, we compute
benchmark for sensitivity of dispersion coefficients of variation. All 3
implementations executes almost instantaneously, with <a href="https://albersonmiranda.github.io/fio/">fio</a>
being slightly slower than <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a> and base R
functions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data</span></span>
<span><span class="va">iom_fio</span><span class="op">$</span><span class="fu">compute_leontief_inverse</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">leontief_inverse_matrix</span> <span class="op">&lt;-</span> <span class="va">iom_fio</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span></span>
<span></span>
<span><span class="co"># base R function</span></span>
<span><span class="va">sensitivity_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span>  <span class="va">SL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span>  <span class="va">ML</span> <span class="op">=</span> <span class="va">SL</span> <span class="op">/</span> <span class="va">n</span></span>
<span>  <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="op">(</span><span class="va">B</span> <span class="op">-</span> <span class="va">ML</span><span class="op">)</span> <span class="op">**</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">**</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="va">ML</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_c</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu"><a href="../reference/compute_sensitivity_dispersion_cv.html">compute_sensitivity_dispersion_cv</a></span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>  `Base R` <span class="op">=</span> <span class="fu">sensitivity_r</span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>  leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/sensitivity_dispersion_cv.html" class="external-link">sensitivity_dispersion_cv</a></span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;      expr      min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;       fio 18.84368 19.14402 20.55910 19.33092 21.95244 25.82193   100</span></span>
<span><span class="co">#&gt;    Base R 20.70250 21.81017 23.14538 22.41280 24.08331 34.13879   100</span></span>
<span><span class="co">#&gt;  leontief 14.07486 14.33243 14.60074 14.44927 14.58205 21.89314   100</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_c</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_c-1.png" alt="\label{fig:benchmark_c} {fio} is about 15 milliseconds slower than {leontief} and 2 milliseconds slower than base R functions." width="70%"><p class="caption">
{fio} is about 15 milliseconds slower than {leontief} and 2 milliseconds
slower than base R functions.
</p>
</div>
</div>
<div class="section level2">
<h2 id="field-of-influence">Field of influence<a class="anchor" aria-label="anchor" href="#field-of-influence"></a>
</h2>
<p>Since field of influence involves computing Leontief inverse matrix
for each element of technical coefficients matrix after an increment, it
can be demanding for high dimensional matrices. Here, we evaluate
benchmark for base R function and {fio}, since there’s no similiar
function in {leontief}. For brevity, we cut dimensions to 100 and
repetitions to 10.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data</span></span>
<span><span class="va">matrix_dim</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span><span class="op">)</span></span>
<span><span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span><span class="op">)</span></span>
<span><span class="va">iom_fio_reduced</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"iom_reduced"</span>,</span>
<span>  <span class="va">intermediate_transactions</span>,</span>
<span>  <span class="va">total_production</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">compute_leontief_inverse</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># base R function</span></span>
<span><span class="va">field_influence_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">ee</span> <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span>
<span>  <span class="va">I</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">SI</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">E</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">ee</span></span>
<span>      <span class="va">AE</span> <span class="op">=</span> <span class="va">A</span> <span class="op">+</span> <span class="va">E</span></span>
<span>      <span class="va">BE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">I</span> <span class="op">-</span> <span class="va">AE</span><span class="op">)</span></span>
<span>      <span class="va">FE</span> <span class="op">=</span> <span class="op">(</span><span class="va">BE</span> <span class="op">-</span> <span class="va">B</span><span class="op">)</span> <span class="op">/</span> <span class="va">ee</span></span>
<span>      <span class="va">FEq</span> <span class="op">=</span> <span class="va">FE</span> <span class="op">*</span> <span class="va">FE</span></span>
<span>      <span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">FEq</span><span class="op">)</span></span>
<span>      <span class="va">SI</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">S</span></span>
<span>      <span class="va">E</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_d</span> <span class="op">&lt;-</span> <span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu"><a href="../reference/compute_field_influence.html">compute_field_influence</a></span><span class="op">(</span></span>
<span>    <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span>,</span>
<span>    <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span>,</span>
<span>    <span class="fl">0.001</span></span>
<span>  <span class="op">)</span>,</span>
<span>  `Base R` <span class="op">=</span> <span class="fu">field_influence_r</span><span class="op">(</span><span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span>, <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: seconds</span></span>
<span><span class="co">#&gt;    expr     min       lq     mean   median       uq      max neval</span></span>
<span><span class="co">#&gt;     fio 2.32139 2.581798 2.587570 2.630586 2.669976 2.713694    10</span></span>
<span><span class="co">#&gt;  Base R 7.78439 7.824686 7.972608 7.847324 7.934813 8.490848    10</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_d</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_d-1.png" alt="\label{fig:benchmark_d} {fio} is the best option for input-output analysis when matrix inversion is needed." width="70%"><p class="caption">
{fio} is the best option for input-output analysis when matrix inversion
is needed.
</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Or in a equivalent way, multiplying intermediate
transactions matrix by a diagonal matrix constructed from total
production vector.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alberson da Silva Miranda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
