<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking M4 • fio</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking M4">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fio</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.6.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/albersonmiranda/fio" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Benchmarking M4</h1>
            
            <h4 data-toc-skip class="date">June 17, 2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/albersonmiranda/fio/blob/main/vignettes/articles/benchmarking_m4.Rmd" class="external-link"><code>vignettes/articles/benchmarking_m4.Rmd</code></a></small>
      <div class="hidden name"><code>benchmarking_m4.Rmd</code></div>

    </div>

    
    
<!-- This is a precomputing script. To run it, `knitr::knit("vignettes/articles/benchmarking_m4_orig.Rmd.orig", output = "vignettes/articles/benchmarking_m4.Rmd")` -->
<style>
p.caption {
  font-size: 0.6em;
  text-align: "center";
}
</style>
<div class="section level2">
<h2 id="disclaimer">DISCLAIMER<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>The present benchmark was conducted on 2025-06-17 on a Macbook Pro M4
(12-core CPU, 16-core GPU, 24GB RAM). Results <em>will</em> vary
depending on the hardware. These benchmarks aim to provide a general
idea of the performance differences between the <code>fio</code> package
and other implementations but should not be considered definitive. The
performance of the functions may also vary depending on the specific
data used and the context in which they are applied.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette presents a benchmarking analysis comparing the
performance of functions from the <code>fio</code> package with
equivalent base R functions and functions from other packages. The
<code>fio</code> package provides a set of functions for input-output
analysis, a method used in economics to analyze the interdependencies
between different sectors of an economy.</p>
<p>Our benchmarking tests show that <code>fio</code> package functions
are either faster or more memory-efficient than other implementations.
This improved performance can make a substantial difference in larger
analyses, making the <code>fio</code> package a valuable tool for
input-output analysis in R.</p>
<p>The tests were run on simulated square matrices, with dimensions
ranging from 100x100 up to 2000x2000, and each test was repeated at
least 50 times to account for variability. Please note that the results
of this benchmarking analysis depend on the specific test datasets used
and the hardware on which the algorithms were run. Therefore, the
results should be interpreted in the context of these specific
conditions.</p>
</div>
<div class="section level2">
<h2 id="technical-coefficients-matrix">Technical coefficients matrix<a class="anchor" aria-label="anchor" href="#technical-coefficients-matrix"></a>
</h2>
<p>The technical coefficients matrix calculation, a key and initial step
in input-output analysis, was tested using the
<code>compute_tech_coeff()</code> function from the <a href="https://albersonmiranda.github.io/fio/">fio</a>
package, equivalent functions from the <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a> package,
and a base R implementation. It consists of dividing each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">a_{ij}</annotation></semantics></math>
element of the intermediate transactions matrix by the corresponding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>j</mi></msub><annotation encoding="application/x-tex">x_j</annotation></semantics></math>
element of the total production vector<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>Results shows that {fio} is generally faster and uses significantly
less memory than the other two implementations, especially for larger
matrices (≥500x500). The memory usage of {fio} is approximately half
that of Base R and 12% of that used by {leontief}.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Base R function</span></span>
<span><span class="va">tech_coeff_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tech_coeff_matrix</span> <span class="op">&lt;-</span> <span class="va">intermediate_transactions</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">total_production</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tech_coeff_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_a</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  matrix_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">iom_fio</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"iom"</span>, <span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>      `Base R` <span class="op">=</span> <span class="fu">tech_coeff_r</span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>      leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/input_requirement.html" class="external-link">input_requirement</a></span><span class="op">(</span><span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span>,</span>
<span>      iterations <span class="op">=</span> <span class="fl">100</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running with:</span></span>
<span><span class="co">#&gt;   matrix_dim</span></span>
<span><span class="co">#&gt; 1        100</span></span>
<span><span class="co">#&gt; 2        500</span></span>
<span><span class="co">#&gt; 3       1000</span></span>
<span><span class="co">#&gt; 4       2000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_a</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 14</span></span>
<span><span class="co">#&gt;    expression matrix_dim      min   median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc total_time result                memory                 time             gc                </span></span>
<span><span class="co">#&gt;    &lt;bch:expr&gt;      &lt;dbl&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;   &lt;bch:tm&gt; &lt;list&gt;                &lt;list&gt;                 &lt;list&gt;           &lt;list&gt;            </span></span>
<span><span class="co">#&gt;  1 fio               100  48.17µs     72µs   12586.   861.83KB      0     100     0     7.95ms &lt;dbl [100 × 100]&gt;     &lt;Rprofmem [6 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  2 Base R            100  52.03µs  82.78µs   10799.   190.65KB      0     100     0     9.26ms &lt;dbl [100 × 100]&gt;     &lt;Rprofmem [12 × 3]&gt;    &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  3 leontief          100 138.13µs 152.93µs    6415.   706.38KB     64.8    99     1    15.43ms &lt;dbl [100 × 100]&gt;     &lt;Rprofmem [351 × 3]&gt;   &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  4 fio               500  433.7µs 646.57µs    1531.     1.91MB     80.6    95     5    62.04ms &lt;dbl [500 × 500]&gt;     &lt;Rprofmem [1 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  5 Base R            500 941.89µs   1.21ms     777.     3.82MB     86.4    90    10   115.81ms &lt;dbl [500 × 500]&gt;     &lt;Rprofmem [3 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  6 leontief          500   1.84ms   2.13ms     469.    16.29MB    826.     38    67    81.07ms &lt;dbl [500 × 500]&gt;     &lt;Rprofmem [1,509 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  7 fio              1000   1.73ms   2.67ms     392.     7.63MB     63.9    86    14   219.15ms &lt;dbl [1,000 × 1,000]&gt; &lt;Rprofmem [1 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  8 Base R           1000   6.54ms   7.85ms     125.    15.27MB     67.5    65    35   518.57ms &lt;dbl [1,000 × 1,000]&gt; &lt;Rprofmem [3 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  9 leontief         1000   8.84ms   8.84ms     113.       65MB  16847.      1   149     8.84ms &lt;dbl [1,000 × 1,000]&gt; &lt;Rprofmem [3,009 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 10 fio              2000   9.02ms  12.94ms      82.1   30.52MB     40.5    67    33   815.73ms &lt;dbl [2,000 × 2,000]&gt; &lt;Rprofmem [1 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 11 Base R           2000  46.12ms  51.36ms      19.3   61.05MB     41.0    32    68      1.66s &lt;dbl [2,000 × 2,000]&gt; &lt;Rprofmem [3 × 3]&gt;     &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 12 leontief         2000  36.67ms  36.67ms      27.3   259.7MB   5400.      1   198    36.67ms &lt;dbl [2,000 × 2,000]&gt; &lt;Rprofmem [6,009 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_a</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_m4_a-1.png" alt="\label{fig:benchmark_a} For larger matrices (≥500x500), {fio} is generally faster and uses significantly less memory: approximately half that of Base R and 12% of that used by {leontief}."><p class="caption">
For larger matrices (≥500x500), {fio} is generally faster and uses
significantly less memory: approximately half that of Base R and 12% of
that used by {leontief}.
</p>
</div>
</div>
<div class="section level2">
<h2 id="leontief-inverse-matrix">Leontief inverse matrix<a class="anchor" aria-label="anchor" href="#leontief-inverse-matrix"></a>
</h2>
<p>The Leontief matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>)
is obtained by subtracting the technical coefficients matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>)
from the identity matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>I</mi><annotation encoding="application/x-tex">I</annotation></semantics></math>);
therefore, it has no null rows or columns. This allows for solving the
linear system
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>×</mo><msup><mi>L</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">L \times L^{-1} = I</annotation></semantics></math>
through LU decomposition, which is a more efficient method than direct
inverse matrix calculation.</p>
<p>Results shows that while {fio} is slightly slower, it demonstrates
superior memory efficiency, using less than half the memory of
alternatives.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base R function</span></span>
<span><span class="va">leontief_inverse_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">dim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span></span>
<span>  <span class="va">leontief_inverse_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">dim</span><span class="op">)</span> <span class="op">-</span> <span class="va">technical_coefficients_matrix</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_b</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  matrix_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">iom_fio</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"iom"</span>, <span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span></span>
<span>    <span class="va">iom_fio</span><span class="op">$</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">technical_coefficients_matrix</span> <span class="op">&lt;-</span> <span class="va">iom_fio</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu">compute_leontief_inverse</span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>      `Base R` <span class="op">=</span> <span class="fu">leontief_inverse_r</span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>      leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/leontief_inverse.html" class="external-link">leontief_inverse</a></span><span class="op">(</span><span class="va">technical_coefficients_matrix</span><span class="op">)</span>,</span>
<span>      iterations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running with:</span></span>
<span><span class="co">#&gt;   matrix_dim</span></span>
<span><span class="co">#&gt; 1        100</span></span>
<span><span class="co">#&gt; 2        500</span></span>
<span><span class="co">#&gt; 3       1000</span></span>
<span><span class="co">#&gt; 4       2000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_b</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 14</span></span>
<span><span class="co">#&gt;    expression matrix_dim      min   median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc total_time result memory              time             gc                </span></span>
<span><span class="co">#&gt;  1 fio               100 136.65µs 442.43µs   1284.    158.51KB    0       100     0    77.88ms &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  2 Base R            100 279.87µs 336.47µs   2868.    413.27KB    0       100     0    34.86ms &lt;NULL&gt; &lt;Rprofmem [20 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  3 leontief          100 219.72µs 330.58µs   3283.    402.57KB    0       100     0    30.46ms &lt;NULL&gt; &lt;Rprofmem [15 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  4 fio               500   4.76ms   5.88ms    166.      3.81MB    1.67     99     1   597.14ms &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  5 Base R            500   3.93ms   4.22ms    231.      9.55MB   12.2      95     5   411.44ms &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  6 leontief          500   3.98ms   4.21ms    229.      9.55MB    9.55     96     4   419.01ms &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  7 fio              1000  22.27ms  26.02ms     38.3    15.26MB    0.781    98     2      2.56s &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  8 Base R           1000  16.08ms  17.46ms     56.5    38.18MB   11.6      83    17      1.47s &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  9 leontief         1000  16.47ms  17.43ms     57.1    38.18MB   12.5      82    18      1.44s &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 10 fio              2000 130.66ms  138.6ms      7.21   61.03MB    1.48     83    17     11.51s &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 11 Base R           2000  85.16ms  88.54ms     11.3   152.66MB   97.4      11    95    975.6ms &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 12 leontief         2000  84.71ms  88.36ms     11.3   152.66MB   63.9      17    96       1.5s &lt;NULL&gt; &lt;Rprofmem [7 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_b</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_m4_b-1.png" alt="\label{fig:benchmark_b} While slightly slower, {fio} demonstrates superior memory efficiency, using less than half the memory of alternatives for matrices 500x500 and larger."><p class="caption">
While slightly slower, {fio} demonstrates superior memory efficiency,
using less than half the memory of alternatives for matrices 500x500 and
larger.
</p>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-of-dispersion-coefficients-of-variation">Sensitivity of dispersion coefficients of variation<a class="anchor" aria-label="anchor" href="#sensitivity-of-dispersion-coefficients-of-variation"></a>
</h2>
<p>To evaluate the performance of linkage-based functions, we
benchmarked the sensitivity of dispersion coefficients of variation.</p>
<p>Results shows that {fio} is substantially faster and more
memory-efficient than {leontief} across all tested dimensions. Compared
to Base R, {fio} is faster for matrices 1000x1000 and larger, while
memory usage remains comparable.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base R function</span></span>
<span><span class="va">sensitivity_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span>  <span class="va">SL</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span></span>
<span>  <span class="va">ML</span> <span class="op">=</span> <span class="va">SL</span> <span class="op">/</span> <span class="va">n</span></span>
<span>  <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="op">(</span><span class="va">B</span> <span class="op">-</span> <span class="va">ML</span><span class="op">)</span> <span class="op">**</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">**</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="va">ML</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_c</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  matrix_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">iom_fio</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"iom"</span>, <span class="va">intermediate_transactions</span>, <span class="va">total_production</span><span class="op">)</span></span>
<span>    <span class="va">iom_fio</span><span class="op">$</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">compute_leontief_inverse</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">leontief_inverse_matrix</span> <span class="op">&lt;-</span> <span class="va">iom_fio</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu">compute_sensitivity_dispersion_cv</span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>      `Base R` <span class="op">=</span> <span class="fu">sensitivity_r</span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>      leontief <span class="op">=</span> <span class="fu">leontief</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leontief/man/sensitivity_dispersion_cv.html" class="external-link">sensitivity_dispersion_cv</a></span><span class="op">(</span><span class="va">leontief_inverse_matrix</span><span class="op">)</span>,</span>
<span>      iterations <span class="op">=</span> <span class="fl">100</span>,</span>
<span>      check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running with:</span></span>
<span><span class="co">#&gt;   matrix_dim</span></span>
<span><span class="co">#&gt; 1        100</span></span>
<span><span class="co">#&gt; 2        500</span></span>
<span><span class="co">#&gt; 3       1000</span></span>
<span><span class="co">#&gt; 4       2000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_c</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 14</span></span>
<span><span class="co">#&gt;    expression matrix_dim      min   median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc total_time result memory                  time             gc                </span></span>
<span><span class="co">#&gt;  1 fio               100 113.41µs  196.9µs   4964.     81.23KB     0      100     0    20.14ms &lt;NULL&gt; &lt;Rprofmem [6 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  2 Base R            100  22.67µs  25.62µs  18105.     81.48KB     0      100     0     5.52ms &lt;NULL&gt; &lt;Rprofmem [5 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  3 leontief          100 528.61µs 543.99µs   1827.    745.38KB    18.5     99     1    54.19ms &lt;NULL&gt; &lt;Rprofmem [522 × 3]&gt;    &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  4 fio               500 451.74µs 639.99µs   1555.      1.91MB     0      100     0     64.3ms &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  5 Base R            500 522.87µs 548.95µs   1805.      1.92MB     0      100     0    55.39ms &lt;NULL&gt; &lt;Rprofmem [5 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  6 leontief          500  10.35ms  11.09ms     90.1    17.31MB     4.74    95     5      1.05s &lt;NULL&gt; &lt;Rprofmem [2,513 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  7 fio              1000   1.47ms   1.66ms    593.      7.64MB     0      100     0   168.68ms &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  8 Base R           1000    1.8ms   2.11ms    473.      7.66MB     9.64    98     2   207.37ms &lt;NULL&gt; &lt;Rprofmem [5 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt;  9 leontief         1000   61.2ms  62.76ms     15.9    68.94MB     3.73    81    19      5.09s &lt;NULL&gt; &lt;Rprofmem [5,013 × 3]&gt;  &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 10 fio              2000      5ms   5.26ms    188.     30.53MB     0      100     0   533.11ms &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 11 Base R           2000   8.25ms   8.41ms    119.     30.58MB    11.8     91     9   765.12ms &lt;NULL&gt; &lt;Rprofmem [5 × 3]&gt;      &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span><span class="co">#&gt; 12 leontief         2000 290.27ms 290.27ms      3.45  275.22MB   575.       1   167   290.27ms &lt;NULL&gt; &lt;Rprofmem [10,013 × 3]&gt; &lt;bench_tm [100]&gt; &lt;tibble [100 × 3]&gt;</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_c</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_m4_c-1.png" alt="\label{fig:benchmark_c} {fio} is substantially faster and more memory-efficient than {leontief} across all tested dimensions. Compared to Base R, {fio} is faster for matrices 1000x1000 and larger, while memory usage remains comparable."><p class="caption">
{fio} is substantially faster and more memory-efficient than {leontief}
across all tested dimensions. Compared to Base R, {fio} is faster for
matrices 1000x1000 and larger, while memory usage remains comparable.
</p>
</div>
</div>
<div class="section level2">
<h2 id="field-of-influence">Field of influence<a class="anchor" aria-label="anchor" href="#field-of-influence"></a>
</h2>
<p>Since computing the field of influence involves calculating the
Leontief inverse matrix for each element of the technical coefficients
matrix after an increment, it can be demanding for high-dimensional
matrices. Here, we benchmark the base R function and <a href="https://albersonmiranda.github.io/fio/">fio</a>,
as there is no similar function in <a href="https://github.com/pachadotdev/leontief" class="external-link">leontief</a>. For brevity,
we limited the matrix dimensions to 200x200 and the number of
repetitions to 20.</p>
<p>Results shows that {fio} is considerably faster for smaller matrices,
but slightly slower for larger ones. However, it uses significantly less
memory across all dimensions. For the 200x200 matrix, {fio} used
625.09KB, while the base R implementation used 83.73GB, which would lead
to memory issues for larger matrices and would make it impractical for
real-world applications, specially in personal computers with limited
memory.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># base R function</span></span>
<span><span class="va">field_influence_r</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">A</span>, <span class="va">B</span>, <span class="va">ee</span> <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span>
<span>  <span class="va">I</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">E</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">SI</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol <span class="op">=</span> <span class="va">n</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">E</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">ee</span></span>
<span>      <span class="va">AE</span> <span class="op">=</span> <span class="va">A</span> <span class="op">+</span> <span class="va">E</span></span>
<span>      <span class="va">BE</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">I</span> <span class="op">-</span> <span class="va">AE</span><span class="op">)</span></span>
<span>      <span class="va">FE</span> <span class="op">=</span> <span class="op">(</span><span class="va">BE</span> <span class="op">-</span> <span class="va">B</span><span class="op">)</span> <span class="op">/</span> <span class="va">ee</span></span>
<span>      <span class="va">FEq</span> <span class="op">=</span> <span class="va">FE</span> <span class="op">*</span> <span class="va">FE</span></span>
<span>      <span class="va">S</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">FEq</span><span class="op">)</span></span>
<span>      <span class="va">SI</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="va">S</span></span>
<span>      <span class="va">E</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">SI</span><span class="op">)</span> <span class="co"># Added return statement</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># benchmark</span></span>
<span><span class="va">benchmark_d</span> <span class="op">&lt;-</span> <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  matrix_dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="va">intermediate_transactions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span>, <span class="va">matrix_dim</span><span class="op">^</span><span class="fl">2</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="va">matrix_dim</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">total_production</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">4000000</span><span class="op">:</span><span class="fl">6000000</span>, <span class="va">matrix_dim</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      ncol <span class="op">=</span> <span class="va">matrix_dim</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">iom_fio_reduced</span> <span class="op">&lt;-</span> <span class="fu">fio</span><span class="fu">::</span><span class="va"><a href="../reference/iom.html">iom</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>      <span class="st">"iom_reduced"</span>,</span>
<span>      <span class="va">intermediate_transactions</span>,</span>
<span>      <span class="va">total_production</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="fu">compute_tech_coeff</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">compute_leontief_inverse</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="https://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      fio <span class="op">=</span> <span class="fu">fio</span><span class="fu">:::</span><span class="fu">compute_field_influence</span><span class="op">(</span></span>
<span>        <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span>,</span>
<span>        <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span>,</span>
<span>        <span class="fl">0.001</span></span>
<span>      <span class="op">)</span>,</span>
<span>      `Base R` <span class="op">=</span> <span class="fu">field_influence_r</span><span class="op">(</span></span>
<span>        <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">technical_coefficients_matrix</span>,</span>
<span>        <span class="va">iom_fio_reduced</span><span class="op">$</span><span class="va">leontief_inverse_matrix</span></span>
<span>      <span class="op">)</span>,</span>
<span>      iterations <span class="op">=</span> <span class="fl">20</span>,</span>
<span>      check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Running with:</span></span>
<span><span class="co">#&gt;   matrix_dim</span></span>
<span><span class="co">#&gt; 1         30</span></span>
<span><span class="co">#&gt; 2         60</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span></span>
<span><span class="co">#&gt; 3        100</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span></span>
<span><span class="co">#&gt; 4        200</span></span>
<span><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">benchmark_d</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 8 × 14</span></span>
<span><span class="co">#&gt;   expression matrix_dim      min   median `itr/sec` mem_alloc `gc/sec` n_itr  n_gc total_time result memory                   time            gc               </span></span>
<span><span class="co">#&gt;   &lt;bch:expr&gt;      &lt;dbl&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;   &lt;bch:tm&gt; &lt;list&gt; &lt;list&gt;                   &lt;list&gt;          &lt;list&gt;           </span></span>
<span><span class="co">#&gt; 1 fio                30   5.43ms   5.48ms  183.       16.67KB     0       20     0   109.52ms &lt;NULL&gt; &lt;Rprofmem [6 × 3]&gt;       &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 2 Base R             30   24.1ms  24.48ms   40.7      44.52MB    10.2     16     4   393.39ms &lt;NULL&gt; &lt;Rprofmem [7,383 × 3]&gt;   &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 3 fio                60 111.31ms 112.34ms    8.90     56.34KB     0       20     0      2.25s &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;       &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 4 Base R             60 659.28ms 677.31ms    1.48     701.2MB     4.14    20    56     13.53s &lt;NULL&gt; &lt;Rprofmem [32,403 × 3]&gt;  &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 5 fio               100    3.18s    5.14s    0.191   156.34KB     0       20     0      1.75m &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;       &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 6 Base R            100    3.84s    3.97s    0.251     5.25GB     4.71    20   376      1.33m &lt;NULL&gt; &lt;Rprofmem [90,003 × 3]&gt;  &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 7 fio               200   41.43s   48.95s    0.0202  625.09KB     0       20     0     16.52m &lt;NULL&gt; &lt;Rprofmem [2 × 3]&gt;       &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="co">#&gt; 8 Base R            200   44.46s   44.85s    0.0218   83.73GB    11.3     20 10379     15.32m &lt;NULL&gt; &lt;Rprofmem [360,003 × 3]&gt; &lt;bench_tm [20]&gt; &lt;tibble [20 × 3]&gt;</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">benchmark_d</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/benchmark_m4_d-1.png" alt="\label{fig:benchmark_d} Across all matrix sizes, {fio} demonstrates superior memory-efficiency. It is also faster for smaller matrices."><p class="caption">
Across all matrix sizes, {fio} demonstrates superior memory-efficiency.
It is also faster for smaller matrices.
</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Or equivalently, multiplying the intermediate
transactions matrix by a diagonal matrix constructed from the total
production vector.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alberson da Silva Miranda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
